(function($) {
    'use strict';
    //Khai báo option global
    var block_01 = $('#block-01'),
        footer = $('.footer'),
        slider_home = $('#slider-home'),
        body = $("body"),
        loading = $("#loading");

    //Check mobile device
    var checkMobileDevice = function(){
        var mobile = false;
        if($(window).width() < 768 && $('#btn-menu').is(':visible')){
            mobile = true;
        }
        return mobile;
    };

    //Set chiều cao của block search
    var setHeightBlockSearch = function(){
        var h_window = $(window).innerHeight(),
            h_header = $('.header-top').outerHeight();
        if(checkMobileDevice()){
            block_01.removeAttr('style');
            slider_home.removeAttr('style');
        }else{
            block_01.css({top: 0, height: h_window});
            slider_home.find('img').css({height: h_window});
        }
    };

    //Fix title homepage

    var fixTitleHomepage = function(){
        var titles = $('[data-scroll="true"]');
        if(checkMobileDevice()){
            titles.each(function(i) {
                var title = $(titles[i]),
                    next = titles[i + 1];
                title.scrollToFixed({
                    marginTop: $('.header-top').outerHeight(true),
                    limit: function() {
                        var limit = 0;
                        if (next) {
                            limit = $(next).offset().top - $(this).outerHeight(true) - 10;
                        } else {
                            limit = $('.footer').offset().top - $(this).outerHeight(true) - 10;
                        }
                        return limit;
                    },
                    baseClassName: 'is-fixed',
                    zIndex: 99
                });
            });
        }
    };

    //Check submenu
    var checkSubMenuMain = function(){
        $('.nav-main > ul > li').each(function(){
            var has_menu  = $(this).find('ul');
            if(has_menu){
                $(this).addClass('has-sub');
            }
        });
    };

    //Slider banner at homepage
    var sliderBannerHomepage = function(){
      try{
          if(!checkMobileDevice()){
              slider_home.bxSlider({
                  mode: 'fade',
                  preloadImages: 'visible',
                  auto: true,
                  speed: 1000,
                  autoHover: true,
                  pause: 5000,
                  pager: false,
                  controls: false
              });
          }
      }catch(e){}
    };

    //Fix vị trí của block search
    var onViewBlockSearch = function(){
        footer.on('inview', function(event, isInView) {
            var h_header = $('.header-top').outerHeight(),
                pos_block_search = $(this).offset().top - $(window).innerHeight()-h_header;
            if(!checkMobileDevice()){
                if (isInView) {
                    block_01.removeClass('is-fixed').css({top: pos_block_search})
                } else {
                    block_01.addClass('is-fixed').css({top: 0})
                }
            }
        });
    };

    //Click để thay đổi kiểu dữ liệu search
    var onChangeTypeSearch = function(){
        var search = $('[data-search="true"]');
        search.each(function(){
            if($(this).hasClass('active')){
                var target = $(this).attr('href'),
                    type = $(this).data('type');
                $(this).addClass('active');
                $(target).attr('value', type);
            }
        });
        search.on('click', function(e){
            e.preventDefault();
            var target = $(this).attr('href'),
                type = $(this).data('type');
            search.removeClass('active');
            $(this).addClass('active');
            $(target).attr('value', type);
        });
    };

    //Click để mở rộng menu footer
    var onMoreMenuFooter = function(){
        var more = $('[data-more="true"]');
        more.on('click', function(e){
            e.preventDefault();
            var parent = '.'+$(this).data('parent'),
                element = $(this).parents(parent).find('.hidden');
            if($(this).hasClass('active')){
                element.slideUp(500);
                $(this)
                    .removeClass('active')
                    .text('More')
                    .attr('title', 'More');
            }else{
                element.slideDown(500);
                $(this)
                    .addClass('active')
                    .text('Less')
                    .attr('title', 'Less');
            }
        })
    };

    //Show/hide menu mobile
    var onMenuMobile = function(){
        $(document).on('click','[data-menu="true"]',function(e){
            e.preventDefault();
            $(this).toggleClass('active');
            var height_menu = $("#menu-left").find('.inner').height(),
                height_device = $(window).height();
            if(height_menu <= height_device) height_menu = height_device;
            if(body.hasClass("show-menu")){
                body.removeClass("show-menu").addClass('hide-menu');
                $("#wrapper").removeAttr("style");
            }else{
                body.removeClass('hide-menu').addClass("show-menu");
                $("#wrapper").css({height: height_menu});
            }
        });
        $(document).on('click','[data-overlay="true"]',function(e){
            e.preventDefault();
            if(body.hasClass("show-menu")){
                body.removeClass("show-menu").addClass('hide-menu');
                $("#wrapper").removeAttr("style");
                $('[data-menu="true"]').removeClass('active');
            }
        });

    };

    var showHideSavedHome = function(){
      $(document).on('click', '[data-open="true"]', function(e){
          e.preventDefault();
          if(body.hasClass('show-saved')){
            //Gọi ajax ở đây
          }else{
              body.addClass('show-saved');
          }
      });
      $(document).on('click', '[data-close="true"]', function(e){
          e.preventDefault();
          body.removeClass('show-saved');
      });
      $(document).on('click', '[data-tab="true"]', function(e){
          e.preventDefault();
          var target = $(this).attr('href'),
              content = '.'+$(this).data('content'),
              group = '.'+$(this).data('group');
          loading.show(300);
          $(this).parents(group).find('[data-tab="true"]').removeClass('active');
          $(this).addClass('active');
          $(group).find(content).hide();
          loading.fadeOut(300,function(){
              $(target).fadeIn(300);
          });

      });
    };
    //Window ready
    jQuery(document).ready(function(){
        checkMobileDevice();
        onChangeTypeSearch();
        onMoreMenuFooter();
        setHeightBlockSearch();
        onViewBlockSearch();
        sliderBannerHomepage();
        checkSubMenuMain();
        onMenuMobile();
        fixTitleHomepage();
        showHideSavedHome();
    });

    //Window resize
    $(window).resize(function(){
        checkMobileDevice();
        setHeightBlockSearch();
    });

    //Window loaded
    $(window).load(function(){
    });

})(jQuery);
